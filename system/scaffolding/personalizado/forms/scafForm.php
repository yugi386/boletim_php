<?php//  ====================================================================================================================					//	SCAFFOLDING PARA CRIAÇÃO DE FORMULARIOS//  ====================================================================================================================					// CODIGO PARA EVITAR EXECUCAO DE BLOCOS SEM PASSAR PELA PAGINA INICIAL	if (!defined('FW_RAIZ'))		die("ERRO DE REDIRECIONAMENTO");	include_once($_SERVER["DOCUMENT_ROOT"]  . FW_RAIZ . "system/checkBlock.php");	// 			$FW_registro = array();		if ($view_tipo == 2 ) {							// ESTA OPERACAO SÓ É EXECUTADA NA ALTERACAO 			$FW_registro = $view_show_registro[0];		//	AQUI TEMOS OS DADOS DO REGISTRO CORRENTE				}?><script> <!--function Caracteres(objeto, limite){        // var limite = 1024;        var erro = "O Limite de caracteres foi atingido!";        tamanho = objeto.value.length;        if (tamanho>limite) {			objeto.value = objeto.value.substring(0,limite);			// alert(erro);        } else {			document.getElementById('restantes').innerHTML = (limite-objeto.value.length);        }}--></script> <style type="text/css">#erro {	text-align: justify;	font-size: 14px;	color: #000000;	background-color: #DCDCDC;	font-family: Arial, monospace;	font-weight: bolder;	padding-left: 0px;	padding-right: 10px;	border-width: 10px;	border-style: solid;	border-left: #ff0000;		border-right: #ff0000;		border-color: #FFA500;	}#form {	/* background-color: #FFE4C4;*/	background-color: #EEE8CD;	border-width: 3px;	border-style: solid;	border-color: #DAA520;		padding-top: 5px;	padding-bottom: 5px;	padding-left: 5px;	padding-right: 5px;	}</style><div id="form"><form name="formulario" method="<?php echo $FW_tipoform; ?>" action="<?php echo FW_RAIZ . $FW_operacao; ?>confirma/sim" enctype="multipart/form-data"><?php		$form = new formLib();							//	classe de formularios		$variaveis = array();		$variaveis = $form->RetornaVar($FW_campos);			$campos = $form->Retorna_Campos($FW_tabela);		//	retona campo da tabela, tipo e tamanho		// CRIANDO AS VARIAVEIS EM TEMPO DE EXECUCAO...		for ($ct=0;$ct<count($variaveis);$ct++) {		//	criando e zerando variaveis que sao construidas em tempo real				$temp = $variaveis[$ct];				$$temp = "";		}				// POVOANDO AS VARIAVEIS COM DADOS DO BANCO (PARA ALTERACAO)		if ($view_tipo == 2) {			for ($ct=0;$ct<count($variaveis);$ct++) {				$temp = $variaveis[$ct];				$$temp = (isset( $FW_registro[substr($temp,1)] ) ? $this->textTransform2(substr($temp,1),$FW_registro[substr($temp,1)],$campos) : "");	//	verificacao para ignorar campos que não estão na tabela			}		}				// VERIFICANDO SE HOUVE A EDICAO DO FORMULARIO POR MAIS DE UMA VEZ DEVIDO A VALIDACAO:			for ($ct=0;$ct<count($variaveis);$ct++) {				$temp = $variaveis[$ct];				$$temp = (isset( $_SESSION[substr($temp,1)] ) ? $_SESSION[substr($temp,1)] : $$temp);					unset($_SESSION[substr($temp,1)]);			}				// VERIFICANDO SE HOUVE A EDICAO DO FORMULARIO POR MAIS DE UMA VEZ DEVIDO A VALIDACAO:			for ($ct=0;$ct<count($variaveis);$ct++) {				$temp = $variaveis[$ct];				$$temp = (isset( $_POST[substr($temp,1)] ) ? $_POST[substr($temp,1)] : $$temp);					unset($_POST[substr($temp,1)]);			}				// EXCLUINDO OS VALORES DEFAULT PARA CAMPOS SELECT, RADIO OU CHECKBOX NA ALTERACAO...		if ($view_tipo == 2 and isset($FW_select)) {		// ESTA OPERACAO SÓ É EXECUTADA NA ALTERACAO DESPREZANDO O DEFAULT DE INCLUSAO					$FW_select = OrdenaVetor($FW_select,$FW_campos);	//	orneda os campos select na ordem do formulario			// die();						$vetformato = array();			$pos = 0;			foreach ($FW_formato as $cab => $valor) {				$vetformato[$pos] = $cab;				// echo $cab;				++$pos;			}			//print_r($FW_formato);			for ($ct=0;$ct<count($FW_formato);$ct++) {										$tmp = $FW_formato[$vetformato[$ct]];				$tmp = str_replace(" checked","",$tmp);				// echo '<textarea rows="10" cols="70" id="resumo4" name="resumo4">' .$FW_formato[$vetformato[$ct]]. '</textarea>';								$FW_formato[$vetformato[$ct]] = str_replace(" checked","",$tmp);					$tmp = $FW_formato[$vetformato[$ct]];				$tmp = str_replace(" selected","",$tmp);				$FW_formato[$vetformato[$ct]] = str_replace(" selected","",$tmp);									// echo '<textarea rows="10" cols="70" id="resumo44" name="resumo44">' .$FW_formato[$vetformato[$ct]] . "<br>" . '</textarea>';							}			//print_r($FW_formato);			//die();		}				// GERANDO O FORMULARIO PROPRIAMENTE DITO				$formulario = $form->GeraTabForm($FW_tabela,$FW_campos,$FW_formato);		$formulario = str_replace("  "," ",$formulario);	// eliminando espacos duplos		$formulario = str_replace(" >",">",$formulario);	// eliminando espaco antes da tag de fechamento		$formulario = str_replace("< ","<",$formulario);	// eliminando espaco depois da tag de abertura				// ordenando o vetor de mascaras para recuperar a informacao dos formularios		$temp = 0;		for ($i = 0; $i<count($variaveis);$i++) {			$temp = max($temp,strlen($variaveis[$i]));			// echo $variaveis[$i];		}			// echo $temp;		// die();				$vetor = array();		$ponteiro = 0;		while (TRUE) {			$verifica = 0;			for ($i = 0; $i<count($variaveis);$i++) {				if ( strlen($variaveis[$i]) == $temp ) {					$vetor[$ponteiro] = $variaveis[$i];					$variaveis[$i] = "";					$verifica = 1;					$ponteiro++;					break;				}			}			if ($verifica == 0) {				$temp = $temp - 1;			}					if ($temp == 0) {				break;			}		}				//	print_r($variaveis);		// print_r($vetor);			// [1] LENDO CAMPOS TEXT, PASSWORD, TEXTAREA					for ($i = 0; $i<count($variaveis);$i++) {			$temp = $vetor[$i];		//	este vetor tem que ser previamente ordenado conforme processo acima			$tmp = (isset($$temp) ? $$temp : "");			$formulario = str_replace("$".$temp,$tmp,$formulario);			}	// [2] LENDO CAMPO SELECT DO BANCO DE DADOS	if (isset($FW_select)) {		if (count($FW_select > 0)) {				$form2 = $formulario;	//	copia do formulario para manipulacao							for ($ct=0;$ct<count($FW_select);$ct++) {				for ($i = 0; $i<count($vetor);$i++) {					$temp = $vetor[$i];						//	este vetor tem que ser previamente ordenado conforme processo acima					$verifica = false;					// echo "inicia<br>"	;					//echo $temp . " - ";					//echo "V".$FW_select[$ct] . "<br>";										if ($temp == "V".$FW_select[$ct]) {			//	Comparando as variaveis com a variavel do campo						$tmp = (isset($$temp) ? $$temp : "");	//	relativo ao select					} else {						continue;					}											$localiza = '<select name="' . $FW_select[$ct] . '" id="'. $FW_select[$ct] . '">';					$finaliza = '</select>';						$pini = stripos($form2, $localiza);						$pfim = stripos($form2, $finaliza);						$subform = substr($form2,$pini,$pfim-$pini+9);										/* if ($pini != 0) {						echo $pini;						echo "<br>";						echo $pfim;						echo "<br>"; */						// echo '<textarea rows="10" cols="70" >' .$subform . '</textarea>';					// }								$tmp2 = '<option value="'. $tmp .'">';							$tmp3 = '<option value="'. $tmp .'" selected>';						//echo '<textarea rows="10" cols="70" id="resumo4" name="resumo4">' .$tmp2 . $tmp3 . '</textarea>';												$subform2 = $subform;						$subform2 = str_replace($tmp2,$tmp3,$subform2);						// echo '<textarea rows="10" cols="70" >' .$subform2 . '</textarea>';						//echo '<textarea rows="10" cols="70" id="resumo3" name="resumo3">' .$subform2 . '</textarea>';										if ($subform != $subform2) {						// echo '<textarea rows="10" cols="70" id="resumo5" name="resumo5">' .$subform2 . '</textarea>';						// echo '<textarea rows="10" cols="70" id="resumo6" name="resumo6">' .$form2 . '</textarea>';						$form2 = substr($form2,$pfim+9);						// echo '<textarea rows="10" cols="70" id="resumo6" name="resumo6">' .$form2 . '</textarea>';						// die();						$verifica = true;						$formulario = str_replace($subform,$subform2,$formulario);		//	TROCA DO CAMPO RADIO						}				}			}			}	}					// [3] LENDO CAMPO RADIO DO BANCO DE DADOS - CORRETO		for ($i = 0; $i<count($variaveis);$i++) {			$temp = $vetor[$i];						//	este vetor tem que ser previamente ordenado conforme processo acima			$tmp = (isset($$temp) ? $$temp : "");						for ($ct=0;$ct<count($campos);$ct++) {				$tmp4 = $campos[$ct][0];				$tmp5 = '<input type="radio" id="' . $tmp4 .'" name="' . $tmp4 . '" value="' . $tmp . '">';				$tmp6 = '<input type="radio" id="' . $tmp4 .'" name="' . $tmp4 . '" value="' . $tmp . '" checked>';								$formulario = str_replace($tmp5,$tmp6,$formulario);		//	TROCA DO CAMPO RADIO			}		}				// [4] LENDO CAMPO CHECKBOX DO BANCO DE DADOS - CORRETO		if (isset($FW_checkbox)) {			if (count($FW_checkbox) != 0) {				$cab = array_keys($FW_checkbox);				$valor = array_values($FW_checkbox);					for ($ct=0;$ct<count($cab);$ct++) {							$tmp4 = $cab[$ct];							$tmp5 = '<input type="checkbox" id="' . $tmp4 .'" name="' . $tmp4 . '" value="' . $valor[$ct] . '">';														// echo '<textarea rows="20" cols="70" id="resumo" name="resumo">' . $tmp5 . '</textarea>';							/*echo '<textarea rows="20" cols="70" id="resumo2" name="resumo2">' .							'<input type="checkbox" id="' . $tmp4 .'" name="' . $tmp4 . '" value="' . $valor[$ct] . '">'							. '</textarea>';*/														if ($tmp5 == '<input type="checkbox" id="' . $tmp4 .'" name="' . $tmp4 . '" value="' . $valor[$ct] . '">') {								$tmp6 = '<input type="checkbox" id="' . $tmp4 .'" name="' . $tmp4 . '" value="' . '1' . '" checked>';								} else {								$tmp6 = '<input type="checkbox" id="' . $tmp4 .'" name="' . $tmp4 . '" value="' . '0' . '">';								}															// echo '<textarea rows="20" cols="70" id="resumo2" name="resumo2">' . $tmp6 .  '</textarea>';							// echo '<textarea rows="20" cols="70" id="resumo2" name="resumo2">' . $formulario .  '</textarea>';							//die();					}									$formulario = str_replace($tmp5,$tmp6,$formulario);		//	TROCA DO CAMPO CHECKBOX			}		}?><?php		//	APRESENTANDO O CORPO DO FOMULARIO ... 				$verifica = false;		if (!isset($_SESSION['posic_erro'])) {			$_SESSION['posic_erro'] = 0;		}		for ($ct=0;$ct<$_SESSION['posic_erro']+1;$ct++){	//	apresentando e eliminado sessão de erros...			if (isset($_SESSION["ERRO".$ct])){				if ($verifica == false) {					echo "<div id='erro'>";									echo "<ul>";				}								$verifica = true;				echo "<LI>";				echo $_SESSION["ERRO".$ct];				unset($_SESSION["ERRO".$ct]);				// echo "<br>";			}		}				$_SESSION['posic_erro'] = 0;	//	resetando ponteiro de erros.		if ($verifica) {			echo "</ul>";			echo "</div>";			echo "<br>";					}		echo  $formulario;				// EXIBINDO O FORMULARIO:		echo "</div>";	//  fim da DIV do formulario		echo "<br>";?>	<!-- CONTROLE DE AÇÕES DO FORMULÁRIO, BOTOES GRAVAR, ALTERAR E VOLTAR -->		<?php if ($view_tipo == '1') { ?>		<input type="image" src="<?php echo FW_SCAF_IMAGE; ?>gravar.png" width="128" height="64" value="ENVIAR" alt="[ GRAVAR ]" />		<img src="<?php echo FW_SCAF_IMAGE; ?>limpar.png" width="128" height="64" onclick=document.forms[0].reset() >	<?php } else { ?>		<input type="image" src="<?php echo FW_SCAF_IMAGE; ?>alterar.png" width="128" height="64" value="ENVIAR" alt="[ ALTERAR ]" />	<?php } ?>	<a href="<?php echo FW_RAIZ  . $view_redir ;?>index"><img src="<?php echo FW_SCAF_IMAGE; ?>voltar.png" width="128" height="64" border="0"></a>	</form><?php# ----------------------------------------------------------------------------------------------------------------------------------------------------------------------function OrdenaVetor($FW_select,$FW_campos) {	// ESTA FUNCAO ORDENA O VETOR $FW_selec que contem os campos select do formulario			$vetformato = array();			$pos = 0;			foreach ($FW_select as $cab => $valor) {				$vetformato[$pos] = $valor;				++$pos;			}			// print_r($vetformato);						// Verificando ordem do formulario			$vetcampos = array();			$pos = 0;			foreach ($FW_campos as $cab => $valor) {				$vetcampos[$pos] = $valor;				++$pos;			}					$pos = 0;			$vetresult = array();			for ($ct=0;$ct<count($vetcampos);$ct++) {				for ($ct2=0;$ct2<count($vetformato);$ct2++) {					if ($vetcampos[$ct] == $vetformato[$ct2]) {						$vetresult[$pos] = $vetcampos[$ct];						++$pos;					}					}				}			// print_r($vetresult);			return $vetresult;			}?>